<!DOCTYPE html>
<html>
  <head>
    <title>FluAntigen</title>
    <meta charset="utf-8" />

    <link rel="stylesheet" href="../css/bootstrap.min.css" />
    <link rel="stylesheet" href="../fontawesome/css/all.css" />
    <link rel="stylesheet" href="../fontawesome/css/fontawesome.css" />
    <link rel="stylesheet" href="../css/select2.min.css" />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.20/css/dataTables.jqueryui.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/buttons/1.6.1/css/buttons.jqueryui.min.css"
    />
    <link
      rel="stylesheet"
      type="text/css"
      href="https://cdn.datatables.net/1.10.20/css/jquery.dataTables.css"
    />
    <style>
      .margin-auto {
        margin: 0 auto;
      }

      .flex-container input,
      .flex-container textarea {
        width: 100%;
      }
      textarea {
        height: 200px;
      }
      #container {
        flex-direction: column;
      }
      .heading {
        background-color: #e9ecef;
      }
      .form-pair {
        position: relative;
      }
      .result-icon {
        position: absolute;
        right: -50px;
        font-size: 35px;
        top: 90px;
        color: #28a745;
      }
      .result-icon.cross {
        color: #dc3545;
      }
      .info-icon {
        font-size: 35px;
        color: #28a745;
      }
      .info-icon.cross {
        color: #dc3545;
      }
      .result-info p {
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .flex-reverse {
        flex-direction: row-reverse;
      }
      .flex-reverse input {
        width: auto;
      }
      .separator {
        max-width: 5px;
      }
      .hide {
        display: none;
      }
      .col-md-12 img {
        width: 100%;
        height: auto;
        border: 1px solid gray;
        max-width: 600px;
        margin: 0 auto;
        display: block;
        margin-top: 20px;
      }
      .select2-selection__rendered {
        line-height: 31px !important;
      }
      .select2-container .select2-selection--single {
        height: 35px !important;
      }
      .select2-selection__arrow {
        height: 34px !important;
      }
      td {
        word-wrap: break-word;
      }
      th,
      td {
        max-width: 300px;
      }
      label {
        font-weight: bold;
      }

      #main {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    width: 100%;
}

#rStudioHeader .rStudio {
    margin-top: 10px;
    font-size: 13px;
    line-height: 25px;
    font-weight: 200;
    color: #808080;
}

#rStudioHeader .productName {
    font-family: "Source Code Pro", monospace;
    font-weight: normal;
    font-size: 40px;
    color: inherit;
    white-space: nowrap;
    -webkit-transition-property: font-size;
    -moz-transition-property: font-size;
    -o-transition-property: font-size;
    transition-property: font-size;
    -webkit-transition-duration: 0.25s;
    -moz-transition-duration: 0.25s;
    -o-transition-duration: 0.25s;
    transition-duration: 0.25s;
}



#rStudioHeader #menu {
    text-align: center;
    font-weight: 400;
    font-size: 14px;
    line-height: 50px;
    white-space: nowrap;
}

#rStudioHeader #menu .menuItem {
    display: inline;
    padding: 0px 15px;
    cursor: pointer;
    border-radius: 3px;
    color: inherit;
    -webkit-transition-property: background-color;
    -moz-transition-property: background-color;
    -o-transition-property: background-color;
    transition-property: background-color;
    -webkit-transition-duration: 0.25s;
    -moz-transition-duration: 0.25s;
    -o-transition-duration: 0.25s;
    transition-duration: 0.25s;
}

.shrinkHeader #rStudioHeader .innards {
    padding: 9px 0;
}
#rStudioHeader .innards {
    padding: 5px 0;
    display: flex;
    justify-content: space-between;
    display: -ms-flexbox;
    -ms-flex-pack: justify;
    display: -webkit-box;
    display: -webkit-flex;
    -webkit-justify-content: space-between;

    -webkit-transition-property: padding;
    -moz-transition-property: padding;
    -o-transition-property: padding;
    transition-property: padding;
    -webkit-transition-duration: 0.5s;
    -moz-transition-duration: 0.5s;
    -o-transition-duration: 0.5s;
    transition-duration: 0.5s;
}
.main {
    padding-top: 100px;
    padding-bottom: 0px;
}
.rStudio {
    display: inline-block;
    margin-top: 5px;
    margin-left: 3px;
}
.rStudio .rStudioLogo {
    display: inline-block;
    width: 25px;
    height: 25px;
    background-image: url(../log/uf.png);
    background-size: 100% auto;
    background-repeat: no-repeat;
    vertical-align: middle;
}
#rStudioFooter.band {
    background-color: #75aadb;
    color: #fff;
    padding: 30px 5%;
    font-weight: normal;
    font-size: 12px;
    line-height: 25px;
}
#rStudioFooter {
    position: relative;
    z-index: 12;
    box-sizing: border-box;
    height: 92px;
}
#rStudioFooter .bandContent {
    display: flex;
    justify-content: space-between;
    display: -ms-flexbox;
    -ms-flex-pack: justify;
    display: -webkit-box;
    display: -webkit-flex;
    -webkit-justify-content: space-between;
    align-items: center;
    line-height: 20px;
}
.bandContent {
    margin: 0 auto;
    max-width: 1200px;
}
#rStudioFooter .bandContent #copyright {
    flex-shrink: 5;
    color: #e3eef8;
}

#rStudioFooter .bandContent #logos {
    flex-shrink: 1;
}

#rStudioFooter .bandContent #logos .footerLogo {
    display: inline-block;
    height: 25px;
    width: 25px;
    background-repeat: no-repeat;
    background-size: 100% auto;
    background-position: center center;
    margin: 0 8px;
}
#rStudioFooter .bandContent #logos .footerLogo.twitter {
    background-image: url(../log/twitterLogo.svg);
}
#rStudioFooter .bandContent #logos .footerLogo.gitHub {
    background-image: url(../log/gitHubLogo.svg);
}
#rStudioFooter .bandContent #logos .footerLogo.linkedIn {
    background-image: url(../log/linkedInLogo.svg);

}#rStudioFooter .bandContent #logos .footerLogo.facebook {
   background-image: url(../log/facebookLogo.svg);
 }
.dropbtn {
  background-color: white;
  color: black;
  padding: 10px;
  font-size: 14px;
  border: none;
  cursor: pointer;
}

/* 容器 <div> - 需要定位下拉内容 */
.dropdown {
  position: relative;
  display: inline-block;
}

/* 下拉内容（默认隐藏）*/
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* 下拉列表中的链接 */
.dropdown-content a {
  color: black;

  text-decoration: none;
  display: block;
  align-content: center;
}

/* 更改悬停时下拉链接的颜色 */
.dropdown-content a:hover {background-color: #f1f1f1}

/* 悬停时显示下拉菜单 */
.dropdown:hover .dropdown-content {
  display: block;
}



    </style>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  </head>
  <head>
    <title>FluAntigen</title>
    <link
      rel="stylesheet"
      href="../fontawesome/css/fontawesome.css"
    />
    <link
      rel="stylesheet"
      href="../fontawesome/css/all.css"
    />
    <link
      rel="stylesheet"
      href="../fontawesome/css/fontawesome.css"
    />
    <link
      rel="stylesheet"
      href="../css/select2.min.css"
    />
    <style type="text/css">
      html,
      body {
        font-family: sans-serif;
        font-size: 16px;
      }
      .row .col-12 {
        padding: 5px;
      }
      .row .col-12 label{
        color: white;
      }
      .back_button_box a{
        margin: 10px;
        position: fixed;
        z-index: 10;
        text-align: center;
        font-size: 40px;
        color: black;
      }
      .filter_box_wrapper{
        width: 320px;
        position: fixed;
        right: 10px;
        bottom: 10px;
        z-index: 9;
      }
      .toggle_button_wrapper{
        text-align:right;
        font-size: 25px;
      }
      .toggle_button{
        font-size: 30px;
        color: black;
      }
      .filter_box{
        background: rgba(0,0,0,0.6);
        padding: 20px;
        border-radius: 10px;
        width: 100%;
      }
      #graph {
        width: 100%;
        height: 100vh;

        font: 22pt arial;
        position: relative;
      }
      #loading {
        top: 0;
        left: 0;
        position: fixed;
        width: 100%;
        height: 100%;
        background: rgba(255, 255, 255, 0.7);
        z-index: 11;
      }
      #loading img {
        margin-top: -35px;
        margin-left: -35px;
        top: 50%;
        left: 50%;
        width: 70px;
        height: 70px;
        position: absolute;
      }
      .btn {
        width: 100%;
      }
      .select2-selection__rendered {
          line-height: 31px !important;
      }
      .select2-container .select2-selection--single {
          height: 35px !important;
      }
      .select2-selection__arrow {
          height: 34px !important;
      }
      .hide {
        display:none;
      }
      #rStudioHeader .rStudio {
    margin-top: 10px;
    font-size: 13px;
    line-height: 25px;
    font-weight: 200;
    color: #808080;
}
      #rStudioHeader {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: auto;
    z-index: 100;
    background-color: rgba(255,255,255,0.98);
    -webkit-box-shadow: 0 3px 15px 0px rgb(0 0 0 / 10%);
    transition-property: left;
    transition-duration: 0.25s;
}
.band {
    position: relative;
    padding: 0 5%;
}



#rStudioHeader .rStudio {
    margin-top: 10px;
    font-size: 13px;
    line-height: 25px;
    font-weight: 200;
    color: #808080;
}

#rStudioHeader .productName {
    font-family: "Source Code Pro", monospace;
    font-weight: normal;
    font-size: 40px;
    color: inherit;
    white-space: nowrap;
    -webkit-transition-property: font-size;
    -moz-transition-property: font-size;
    -o-transition-property: font-size;
    transition-property: font-size;
    -webkit-transition-duration: 0.25s;
    -moz-transition-duration: 0.25s;
    -o-transition-duration: 0.25s;
    transition-duration: 0.25s;
}



#rStudioHeader #menu {
    text-align: center;
    font-weight: 400;
    font-size: 14px;
    line-height: 50px;
    white-space: nowrap;
}

#rStudioHeader #menu .menuItem {
    display: inline;
    padding: 0px 15px;
    cursor: pointer;
    border-radius: 3px;
    color: inherit;
    -webkit-transition-property: background-color;
    -moz-transition-property: background-color;
    -o-transition-property: background-color;
    transition-property: background-color;
    -webkit-transition-duration: 0.25s;
    -moz-transition-duration: 0.25s;
    -o-transition-duration: 0.25s;
    transition-duration: 0.25s;
}

.shrinkHeader #rStudioHeader .innards {
    padding: 9px 0;
}
#rStudioHeader .innards {
    padding: 5px 0;
    display: flex;
    justify-content: space-between;
    display: -ms-flexbox;
    -ms-flex-pack: justify;
    display: -webkit-box;
    display: -webkit-flex;
    -webkit-justify-content: space-between;

    -webkit-transition-property: padding;
    -moz-transition-property: padding;
    -o-transition-property: padding;
    transition-property: padding;
    -webkit-transition-duration: 0.5s;
    -moz-transition-duration: 0.5s;
    -o-transition-duration: 0.5s;
    transition-duration: 0.5s;
}
.main {
    padding-top: 100px;
    padding-bottom: 0px;
}
.rStudio {
    display: inline-block;
    margin-top: 5px;
    margin-left: 3px;
}
.rStudio .rStudioLogo {
    display: inline-block;
    width: 25px;
    height: 25px;
    background-image: url(../log/uf.png);
    background-size: 100% auto;
    background-repeat: no-repeat;
    vertical-align: middle;
}
#rStudioFooter.band {
    background-color: #75aadb;
    color: #fff;
    padding: 30px 5%;
    font-weight: normal;
    font-size: 12px;
    line-height: 25px;
}
#rStudioFooter {
    position: relative;
    z-index: 12;
    box-sizing: border-box;
    height: 92px;
}
#rStudioFooter .bandContent {
    display: flex;
    justify-content: space-between;
    display: -ms-flexbox;
    -ms-flex-pack: justify;
    display: -webkit-box;
    display: -webkit-flex;
    -webkit-justify-content: space-between;
    align-items: center;
    line-height: 20px;
}
.bandContent {
    margin: 0 auto;
    max-width: 1200px;
}
#rStudioFooter .bandContent #copyright {
    flex-shrink: 5;
    color: #e3eef8;
}

#rStudioFooter .bandContent #logos {
    flex-shrink: 1;
}

#rStudioFooter .bandContent #logos .footerLogo {
    display: inline-block;
    height: 25px;
    width: 25px;
    background-repeat: no-repeat;
    background-size: 100% auto;
    background-position: center center;
    margin: 0 8px;
}
#rStudioFooter .bandContent #logos .footerLogo.twitter {
    background-image: url(../log/twitterLogo.svg);
}
#rStudioFooter .bandContent #logos .footerLogo.gitHub {
    background-image: url(../log/gitHubLogo.svg);
}
#rStudioFooter .bandContent #logos .footerLogo.linkedIn {
    background-image: url(../log/linkedInLogo.svg);

}#rStudioFooter .bandContent #logos .footerLogo.facebook {
   background-image: url(../log/facebookLogo.svg);
 }
.dropbtn {
  background-color: white;
  color: black;
  padding: 10px;
  font-size: 14px;
  border: none;
  cursor: pointer;
}

/* 容器 <div> - 需要定位下拉内容 */
.dropdown {
  position: relative;
  display: inline-block;
}

/* 下拉内容（默认隐藏）*/
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  min-width: 160px;
  box-shadow: 0px 8px 16px 0px rgba(0,0,0,0.2);
  z-index: 1;
}

/* 下拉列表中的链接 */
.dropdown-content a {
  color: black;

  text-decoration: none;
  display: block;
  align-content: center;
}

/* 更改悬停时下拉链接的颜色 */
.dropdown-content a:hover {background-color: #f1f1f1}

/* 悬停时显示下拉菜单 */
.dropdown:hover .dropdown-content {
  display: block;
}

/* 显示下拉内容时更改下拉按钮的背景颜色 */



    </style>
    <link
      rel="stylesheet"
      href="../css/bootstrap.min.css"
    />

    <script src="../js/neovis.js"></script>
  </head>
  <body>





    <div id="rStudioHeader">
      <div class="band">
        <div class="innards bandContent">
          <div>
            <a class="productName" href="../index.html">FluAntigen</a>
            <div class="rStudio">
              <span>from </span>
              <a href="https://www.ufl.edu/">
                <div class="rStudioLogo"></div>
              </a>
            </div>
          </div>


          <div id="menu">
            <div id="menuItems" class="showMenu">
              <a  class="menuItem"  href="../index.html">Home</a>
              <a  class="menuItem"  href="../database/index.html">Database</a>
              <div  class="dropdown"  href="../graph/index.html">
                <button class="dropbtn" >Data Visualization</button>
                <div class="dropdown-content">
                  <a href="../graph/index.html">Antigenic Network</a>
                  <a href="../geneticgraph/index.html" >Genetic Network</a>
                  <a href="../analysis/index.html" >Data Analysis</a>
                </div>
              </div>
              <a  class="menuItem"  href="../prediction/index.html">Prediction</a>
              <a  class="menuItem"  href="../instruction/index.html">Instruction</a>
              <a  class="menuItem"  href="../contact/index.html">Contact</a>
            </div>
          </div>
        </div>
      </div>
    </div>



    <div class="main">
      <div class="container">
        <div class="row">
          <div class="col-md-2"></div>
          <div class="col-md-8">
            <br />
            <h1>Database Searching and Retrieval</h1>
            <p>
              The collection of influenza antigenic data which are used in
              training of IAV-CNN machine learning model and conscturion of
              graph representation.
            </p>
          </div>
          <div class="col-md-2"></div>
        </div>
        <hr />
        <br />
        <div id="msg-box"></div>
        <div class="row">
          <div class="col-md-6">
            <div class="form-group">
              <label>Please select a strain:</label>
              <select class="form-control" id="name"> </select>
            </div>
            <div class="form-group">
              <label>Please select a relation:</label>
              <select class="form-control" id="relationType">
                <option value="0">Antigenetic Distance</option>
                <option value="3">Genetic Distance</option>
                <option value="1">Sequence Similarity</option>
                <option value="2">HI Titer Value</option>
              </select>
            </div>
            <div class="form-group">
              <select class="form-control" id="operator">
                <option value="0">>=</option>
                <option value="1"><=</option>
              </select>
            </div>
            <div class="form-group">
              <input
                type="text"
                class="form-control"
                placeholder="option value"
                id="optionValue"
              />
            </div>
            <div class="form-group">Note: The HI (Hemagglutination Inhibition) Titer Value
              is the maximum dilution of antisera raised in Antigen (The strain we chose above)
              to inhibit cell agglutination caused by Antisera (The relevant strains shown below).</div>
          </div>
          <div class="col-md-6">
            <label>#</label>
            <table class="table">

                <tr>
                  <th scope="row">Subtype</th>
                  <td id="current_subtype">...</td>
                </tr>
                <tr>
                  <th scope="row">Region</th>
                  <td id="current_region">...</td>
                </tr>
                <tr>
                  <th scope="row">Sequence</th>
                  <td id="current_sequence">...</td>
                </tr>


            </table>
          </div>
        </div>
        <hr />
        <div class="row">
          <div class="col-md-12" id="table_container"></div>
        </div>
      </div>
      <br />
      <br />
    </div>


    <div id="rStudioFooter" class="band">
      <div class="bandContent">
        <div id="copyright">© Copyright xxxxxxxxx.</div>
        <div id="logos">
          <a href="https://twitter.com/" class="footerLogo twitter"></a>
          <a href="https://github.com/" class="footerLogo gitHub"></a>
          <a href="https://www.linkedin.com/" class="footerLogo linkedIn"></a>
          <a href="https://www.facebook.com/" class="footerLogo facebook"></a>
        </div>
      </div>
    </div>





    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"
      integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q"
      crossorigin="anonymous"
    ></script>
    <script
      src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"
      integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl"
      crossorigin="anonymous"
    ></script>
    <div class="hide">
      <div id="error_msg">
        <div
          class="alert alert-danger alert-dismissible fade show"
          role="alert"
        >
          <strong>Error!</strong> Please check the input below make sure values
          are correct.
          <button
            type="button"
            class="close"
            data-dismiss="alert"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
      <div id="success_msg">
        <div
          class="alert alert-success alert-dismissible fade show"
          role="alert"
        >
          <strong>Success!</strong> Please check the result below.
          <button
            type="button"
            class="close"
            data-dismiss="alert"
            aria-label="Close"
          >
            <span aria-hidden="true">&times;</span>
          </button>
        </div>
      </div>
    </div>
    <script src="../js/jquery-3.5.0.min.js" type="text/javascript"></script>
    <script src="../js/select2.min.js" type="text/javascript"></script>
    <script src="../js/neo4j-web.js" type="text/javascript"></script>
    <script
      type="text/javascript"
      charset="utf8"
      src="https://cdn.datatables.net/1.10.20/js/jquery.dataTables.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/1.10.20/js/dataTables.jqueryui.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/buttons/1.6.1/js/dataTables.buttons.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.jqueryui.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.html5.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.print.min.js"
    ></script>
    <script
      type="text/javascript"
      language="javascript"
      src="https://cdn.datatables.net/buttons/1.6.1/js/buttons.colVis.min.js"
    ></script>
    <script>
      var tableHtml = `<table id="table_id" class="display">
              <thead>
                <tr>
                  <th>Strain Name</th>
                  <th>Subtype</th>
                  <th>Region</th>
                  <th>Value</th>
                  <th>Sequence</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>`;
      var tableOption = {
        dom: "Bfrtip",
        buttons: ["copy", "csv", "excel", "pdf", "print"],
        columns: [null, null, null, null, { width: "30%" }],
      };
      var driver = neo4j.driver(
        "bolt://localhost:7687",
        neo4j.auth.basic("neo4j", "Password123$")
      );

      function loadStrains() {
        let session = driver.session();
        let readTxResultPromise = session.readTransaction((txc) => {
          return txc.run(
            "MATCH p=(s1:Strain)-[]-(s2:Strain) RETURN DISTINCT s1.name LIMIT 1664;"
          );
        });

        // returned Promise can be later consumed like this:
        readTxResultPromise
          .then((result) => {
            let data = [{ id: "All", text: "" }];
            result.records.forEach(function (record, index) {
              data.push({ id: record._fields[0], text: record._fields[0] });
            });
            $("#name").select2({ placeholder: "Search strain", data: data });
          })
          .catch((error) => {
            console.log(error);
          })
          .then(() => session.close());
      }

      function loadTable(name, subType, relationType, value, operator) {

        const strainName = name === "All" ? "" : `{name:'${name}'}`;
        const relation = relationType == "1" ? "SEQUENCE_SIMILARITY" :relationType=="0" ? "DISTANCE":relationType=="2" ? "HI_TITER_VALUE":"GENETIC_DISTANCE";
        //const operationValue = relationType == "1" ? value / 100 : (relationType=="0" ? value:value);
        const operationValue = relationType == "1" ? value / 100 : relationType=="0" ? value:relationType=="2"?value:value;
        const operatorString = operator == 1 ? "<=" : ">=";
        const operatorQuery =
          value === "" ? "" : `AND r.value ${operatorString} ${operationValue}`;
        const subTypeString =
          subType === "All"
            ? ""
            : `s1.type = '${subType}' AND s2.type = '${subType}'`;
        const whereCause =
          subTypeString !== "" || operatorQuery !== ""
            ? `WHERE ${subTypeString} ${operatorQuery}`
            : "";
        const cipher = relationType == "1" ? `MATCH p=(s1:Strain${strainName})-[r:${relation}]-(s2:Strain) ${whereCause} RETURN *`
                        : relationType=="0" ? `MATCH p=(s1:Strain${strainName})-[r:${relation}]-(s2:Strain) ${whereCause} RETURN *`
                        :relationType=="2"?`MATCH p=(s1:Strain${strainName})-[r:${relation}]->(s2:Strain) ${whereCause} RETURN *`
                                :`MATCH p=(s1:Strain${strainName})-[r:${relation}]-(s2:Strain) ${whereCause} RETURN *`;


        console.log(cipher);

        let session = driver.session();
        let readTxResultPromise = session.readTransaction((txc) => {
          return txc.run(cipher);
        });

        // returned Promise can be later consumed like this:
        readTxResultPromise
          .then((result) => {
            // construct table here
            let tableBody = "";
            let currentNode = null;


            //col-md-12
            result.records.forEach(function (record, index) {
              currentNode = record._fields[2];
              const foundNode = record._fields[3];
              const relation = record._fields[1];

              if (!!foundNode) {
                // show percentage for relation similarity
                let relationValue = relation.properties.value;
                if (relationType == 1) {
                  relationValue = `${(relationValue * 100).toFixed(2)}%`;
                }
                tableBody += "<tr>";
                tableBody += `<td>${foundNode.properties.name}</td>`;
                tableBody += `<td>${foundNode.properties.type}</td>`;
                tableBody += `<td>${foundNode.properties.region}</td>`;
                tableBody += `<td>${relationValue}</td>`;
                tableBody += `<td>${foundNode.properties.sequence}</td>`;


                tableBody += "</tr>"
              }
            });
            //col-md-6
            $("#table_container").html(tableHtml);
            $("#table_id tbody").html(tableBody);
            $("#table_id").DataTable(tableOption);

            if (currentNode) {
              $("#current_subtype").html(currentNode.properties.type);
              $("#current_region").html(currentNode.properties.region);
              $("#current_sequence").html(currentNode.properties.sequence);
            }
            else {
              $("#current_subtype").html('<i style="color: red;">No Relations found.</i>');
              $("#current_region").html('--');
              $("#current_sequence").html('--');
            }

          })
          .catch((error) => {
            console.log(error);
          })
          .then(() => session.close());
      }
    //
      function reLoad() {
        const name = document.getElementById("name").value;

        if (!name || name.toLowerCase() === 'all')
          return;

        const subType = "All";
        const relationType = document.getElementById("relationType").value;
        const optionValue = document.getElementById("optionValue").value;
        const operator = document.getElementById("operator").value;

        loadTable(name, subType, relationType, optionValue, operator);
      }

      $("select").change(function () {
        reLoad();
      });

      $("input").change(function () {
        reLoad();
      });

      $(document).ready(function () {
        loadStrains();
        $("#table_container").html(tableHtml);
        $("#table_id").DataTable(tableOption);
      });
    </script>
  </body>
</html>
